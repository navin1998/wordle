<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <title>Wordle - by Navin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Animations */
        @keyframes flip {
            0% { transform: rotateX(0); }
            50% { transform: rotateX(90deg); }
            100% { transform: rotateX(0); }
        }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .animate-flip { animation: flip 0.5s ease forwards; }
        .animate-pop { animation: pop 0.1s ease-in-out; }
        .animate-shake { animation: shake 0.6s cubic-bezier(.36,.07,.19,.97) both; }

        /* Tile Delays for flip animation */
        .delay-0 { animation-delay: 0ms; }
        .delay-100 { animation-delay: 250ms; }
        .delay-200 { animation-delay: 500ms; }
        .delay-300 { animation-delay: 750ms; }
        .delay-400 { animation-delay: 1000ms; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center font-sans">

    <!-- Header -->
    <header class="w-full border-b border-gray-700 p-4 text-center mb-4">
        <h1 class="text-3xl font-bold tracking-wider">WORDLE <span class="text-xs font-normal text-gray-400">BY NAVIN</span></h1>
    </header>

    <!-- LOADING SCREEN (Shown while fetching words.txt) -->
    <div id="loading-screen" class="mt-20 text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500 mx-auto mb-4"></div>
        <p class="text-gray-400">Loading dictionary from <span class="font-mono text-green-400">words.txt</span>...</p>
        <p class="text-xs text-gray-600 mt-2">Ensure you are running a local server.</p>
    </div>

    <!-- SETUP SCREEN -->
    <div id="setup-screen" class="w-full max-w-md p-6 bg-gray-800 rounded-lg shadow-xl mt-10 hidden">
        <h2 class="text-xl font-bold mb-6 text-center text-green-400">Game Setup</h2>

        <div class="mb-6">
            <label class="block text-sm font-medium mb-2 text-gray-300">Max Guesses (1-10)</label>
            <input type="number" id="input-max-guesses" min="1" max="10" value="6"
                   class="w-full bg-gray-700 border border-gray-600 rounded p-3 text-white focus:outline-none focus:border-green-500 transition-colors">
            <p id="error-guesses" class="text-red-400 text-xs mt-1 hidden">Guesses must be between 1 and 10.</p>
        </div>

        <div class="mb-8">
            <label class="block text-sm font-medium mb-2 text-gray-300">Target Word (5 Letters)</label>
            <div class="relative">
                <input type="password" id="input-target-word" maxlength="5" placeholder="HIDDEN"
                       class="w-full bg-gray-700 border border-gray-600 rounded p-3 text-white uppercase tracking-widest focus:outline-none focus:border-green-500 transition-colors">
                <button id="toggle-visibility" class="absolute right-3 top-3 text-gray-400 hover:text-white text-xs uppercase">
                    Show
                </button>
            </div>
            <p id="error-target" class="text-red-400 text-xs mt-1 hidden">Word must be 5 letters and in the dictionary.</p>
        </div>

        <button id="btn-start" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded transition-colors">
            Start Game
        </button>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="flex flex-col items-center w-full max-w-lg px-2 hidden">

        <!-- Toast Notification Area -->
        <div id="toast-container" class="fixed top-20 z-50 flex flex-col items-center pointer-events-none"></div>

        <!-- The Grid -->
        <div id="grid-container" class="grid gap-1.5 mb-6 p-2">
            <!-- Grid generated by JS -->
        </div>

        <!-- The Keyboard -->
        <div id="keyboard-container" class="w-full max-w-lg mb-4">
            <!-- Keyboard generated by JS -->
        </div>
    </div>

    <!-- MODAL (Game Over) -->
    <div id="modal-overlay" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 p-8 rounded-lg shadow-2xl text-center max-w-sm mx-4 transform transition-all scale-100">
            <h2 id="modal-title" class="text-2xl font-bold mb-2"></h2>
            <div id="modal-content" class="text-gray-300 mb-6"></div>
            <button onclick="location.reload()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded uppercase tracking-wide">
                Play Again
            </button>
        </div>
    </div>

<script>
/**
 * GLOBAL GAME STATE
 */
const VALID_WORDS = new Set();
let TARGET_WORD = "";
let MAX_GUESSES = 6;
let currentGuess = "";
let guesses = []; // Array of strings
let isGameOver = false;

// UI Elements
const loadingScreen = document.getElementById('loading-screen');
const setupScreen = document.getElementById('setup-screen');
const gameScreen = document.getElementById('game-screen');
const gridContainer = document.getElementById('grid-container');
const keyboardContainer = document.getElementById('keyboard-container');
const toastContainer = document.getElementById('toast-container');
const modalOverlay = document.getElementById('modal-overlay');

/**
 * INITIALIZATION: Load words from file
 */
window.addEventListener('DOMContentLoaded', async () => {
    try {
        // Fetch the file locally. This requires a local server (Live Server or python -m http.server)
        const response = await fetch('words.txt');

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const text = await response.text();

        // Parse words: Split by new line, trim, lowercase, ensure 5 letters
        text.split(/\r?\n/).forEach(line => {
            const cleanWord = line.trim().toLowerCase();
            if (cleanWord.length === 5) {
                VALID_WORDS.add(cleanWord);
            }
        });

        if (VALID_WORDS.size === 0) {
            throw new Error("words.txt is empty or contains no 5-letter words.");
        }

        // Hide loader, show setup
        loadingScreen.classList.add('hidden');
        setupScreen.classList.remove('hidden');

    } catch (error) {
        console.error("Dictionary Load Error:", error);
        loadingScreen.innerHTML = `
            <div class="text-red-500 font-bold mb-2">Error Loading Dictionary</div>
            <div class="text-sm text-gray-400 max-w-xs mx-auto">
                Could not load 'words.txt'.<br>
                1. Ensure <b>words.txt</b> is in the same folder.<br>
                2. You must use a <b>Local Server</b> (not file://).
            </div>
        `;
    }
});

/**
 * SETUP LOGIC
 */
const inputGuesses = document.getElementById('input-max-guesses');
const inputTarget = document.getElementById('input-target-word');
const btnStart = document.getElementById('btn-start');
const errorGuesses = document.getElementById('error-guesses');
const errorTarget = document.getElementById('error-target');
const btnToggle = document.getElementById('toggle-visibility');

btnToggle.addEventListener('click', () => {
    const type = inputTarget.getAttribute('type') === 'password' ? 'text' : 'password';
    inputTarget.setAttribute('type', type);
    btnToggle.innerText = type === 'password' ? 'SHOW' : 'HIDE';
});

btnStart.addEventListener('click', () => {
    let valid = true;

    // Validate Max Guesses
    const gVal = parseInt(inputGuesses.value);
    if (isNaN(gVal) || gVal < 1 || gVal > 10) {
        errorGuesses.classList.remove('hidden');
        valid = false;
    } else {
        errorGuesses.classList.add('hidden');
        MAX_GUESSES = gVal;
    }

    // Validate Target Word
    const tVal = inputTarget.value.trim().toLowerCase();
    if (tVal.length !== 5 || !VALID_WORDS.has(tVal)) {
        errorTarget.classList.remove('hidden');
        valid = false;
    } else {
        errorTarget.classList.add('hidden');
        TARGET_WORD = tVal;
    }

    if (valid) {
        startGame();
    }
});

/**
 * GAME START
 */
function startGame() {
    setupScreen.classList.add('hidden');
    gameScreen.classList.remove('hidden');
    initGrid();
    initKeyboard();
    window.addEventListener('keydown', handleKeydown);
}

/**
 * CORE GAME LOGIC
 */
function initGrid() {
    gridContainer.style.gridTemplateRows = `repeat(${MAX_GUESSES}, minmax(0, 1fr))`;
    gridContainer.style.gridTemplateColumns = `repeat(5, minmax(0, 1fr))`;
    gridContainer.innerHTML = '';

    for (let i = 0; i < MAX_GUESSES * 5; i++) {
        const box = document.createElement('div');
        box.className = 'w-14 h-14 border-2 border-gray-600 flex items-center justify-center text-3xl font-bold uppercase select-none';
        box.id = `box-${i}`;
        gridContainer.appendChild(box);
    }
}

const KEYBOARD_LAYOUT = [
    "qwertyuiop",
    "asdfghjkl",
    "zxcvbnm"
];

function initKeyboard() {
    keyboardContainer.innerHTML = '';

    KEYBOARD_LAYOUT.forEach(rowStr => {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'flex justify-center mb-2 gap-1';

        rowStr.split('').forEach(char => {
            const key = document.createElement('button');
            key.innerText = char;
            key.id = `key-${char}`;
            key.className = 'h-14 w-10 sm:w-12 bg-gray-500 rounded font-bold uppercase hover:bg-gray-600 transition-colors';
            key.onclick = () => handleInput(char);
            rowDiv.appendChild(key);
        });

        // Add Enter/Backspace to last row
        if (rowStr === "zxcvbnm") {
            const enter = document.createElement('button');
            enter.innerText = 'ENTER';
            enter.className = 'h-14 px-3 bg-gray-500 rounded font-bold text-xs uppercase hover:bg-gray-600 transition-colors ml-1';
            enter.onclick = () => handleInput('Enter');
            rowDiv.prepend(enter);

            const back = document.createElement('button');
            back.innerHTML = '&#9003;'; // Backspace symbol
            back.className = 'h-14 px-3 bg-gray-500 rounded font-bold text-lg uppercase hover:bg-gray-600 transition-colors mr-1';
            back.onclick = () => handleInput('Backspace');
            rowDiv.appendChild(back);
        }

        keyboardContainer.appendChild(rowDiv);
    });
}

function handleKeydown(e) {
    if (e.metaKey || e.ctrlKey || e.altKey) return;
    handleInput(e.key);
}

function handleInput(key) {
    if (isGameOver) return;

    if (key === 'Backspace') {
        if (currentGuess.length > 0) {
            currentGuess = currentGuess.slice(0, -1);
            updateGrid();
        }
        return;
    }

    if (key === 'Enter') {
        if (currentGuess.length !== 5) {
            showToast("Not enough letters");
            shakeRow();
            return;
        }
        if (!VALID_WORDS.has(currentGuess)) {
            showToast("Not in word list");
            shakeRow();
            return;
        }
        submitGuess();
        return;
    }

    // Handle letters
    if (/^[a-zA-Z]$/.test(key) && currentGuess.length < 5) {
        currentGuess += key.toLowerCase();
        // Pop animation for typing
        const currentRow = guesses.length;
        const boxIdx = currentRow * 5 + (currentGuess.length - 1);
        const box = document.getElementById(`box-${boxIdx}`);

        box.classList.remove('animate-pop');
        void box.offsetWidth; // trigger reflow
        box.classList.add('animate-pop');

        updateGrid();
    }
}

function updateGrid() {
    const currentRow = guesses.length;
    const startIdx = currentRow * 5;

    // Clear current row visual first (optimization)
    for (let i = 0; i < 5; i++) {
        const box = document.getElementById(`box-${startIdx + i}`);
        box.innerText = "";
        box.classList.remove('border-gray-400', 'border-gray-600');
        box.classList.add('border-gray-600');
    }

    // Fill letters
    for (let i = 0; i < currentGuess.length; i++) {
        const box = document.getElementById(`box-${startIdx + i}`);
        box.innerText = currentGuess[i];
        box.classList.remove('border-gray-600');
        box.classList.add('border-gray-400'); // Highlight border for typed letters
    }
}

function submitGuess() {
    const rowStart = guesses.length * 5;
    const guessArr = currentGuess.split('');
    const targetArr = TARGET_WORD.split('');
    const resultColors = Array(5).fill('bg-gray-600'); // Default Gray

    // Logic for Wordle Colors
    // 1. Check Greens
    const targetCharCounts = {};
    targetArr.forEach(c => targetCharCounts[c] = (targetCharCounts[c] || 0) + 1);

    guessArr.forEach((char, i) => {
        if (char === targetArr[i]) {
            resultColors[i] = 'bg-green-600'; // Green
            targetCharCounts[char]--;
        }
    });

    // 2. Check Yellows
    guessArr.forEach((char, i) => {
        if (resultColors[i] === 'bg-green-600') return;

        if (targetCharCounts[char] > 0) {
            resultColors[i] = 'bg-yellow-500'; // Yellow
            targetCharCounts[char]--;
        }
    });

    // ANIMATE REVEAL
    guessArr.forEach((char, i) => {
        const box = document.getElementById(`box-${rowStart + i}`);
        const delayClass = `delay-${i * 100}`;

        // Wait for flip midpoint to change color
        setTimeout(() => {
            box.classList.remove('border-gray-400', 'border-gray-600', 'bg-transparent');
            box.classList.add(resultColors[i], 'border-transparent', 'text-white');
            updateKeyboard(char, resultColors[i]);
        }, 250 + (i * 250)); // Sync with flip animation midpoint

        box.classList.add('animate-flip', delayClass);
    });

    guesses.push(currentGuess);

    // Check Win/Loss after animation
    setTimeout(() => {
        if (currentGuess === TARGET_WORD) {
            showModal("Splendid!", "You guessed the word correctly!");
            isGameOver = true;
        } else if (guesses.length >= MAX_GUESSES) {
            showModal("Game Over", `The word was <span class="text-green-400 uppercase font-bold">${TARGET_WORD}</span>`);
            isGameOver = true;
        }
        currentGuess = "";
    }, 1500);
}

function updateKeyboard(char, colorClass) {
    const key = document.getElementById(`key-${char}`);
    if (!key) return;

    // Priority: Green > Yellow > Gray
    const currentClass = key.className;
    if (currentClass.includes('bg-green-600')) return; // Already correct
    if (currentClass.includes('bg-yellow-500') && colorClass !== 'bg-green-600') return; // Already present, don't revert to gray

    // Reset background classes
    key.classList.remove('bg-gray-500', 'hover:bg-gray-600', 'bg-yellow-500', 'bg-gray-600');
    key.classList.add(colorClass);
}

function shakeRow() {
    const rowStart = guesses.length * 5;
    for (let i = 0; i < 5; i++) {
        const box = document.getElementById(`box-${rowStart + i}`);
        box.classList.remove('animate-shake');
        void box.offsetWidth;
        box.classList.add('animate-shake');
    }
}

/**
 * UTILS
 */
function showToast(msg) {
    const toast = document.createElement('div');
    toast.className = 'bg-white text-black px-4 py-2 rounded font-bold mb-2 shadow opacity-100 transition-opacity duration-500';
    toast.innerText = msg;
    toastContainer.appendChild(toast);

    setTimeout(() => {
        toast.classList.add('opacity-0');
        setTimeout(() => toast.remove(), 500);
    }, 1500);
}

function showModal(title, content) {
    document.getElementById('modal-title').innerText = title;
    document.getElementById('modal-content').innerHTML = content;
    modalOverlay.classList.remove('hidden');
}

</script>
</body>
</html>
